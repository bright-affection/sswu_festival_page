{% load static %} {% load custom_filters %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>booking-info</title>
    <link rel="stylesheet" href="{% static 'css/reserve.css' %}"  />
  </head>
  <body>
    <!-- 상단바 -->
    <header class="header">
      <a><img class="backicon" src="{% static 'img/backicon.svg' %}" alt="뒤로가기" class="list_icon"></a>
      <img class="prism" src="{% static 'img/prismPink.svg' %}" alt="로고" class="list_icon2" id="logo">
    <input class="menu-btn" type="checkbox" id="menu-btn" />
    <label class='menu-icon' for="menu-btn">
    <div class='menu-button' onclick="toggle()">
      <img src="{% static 'img/hamburger.svg' %}" alt="로고" class="Group 1_pink">
    </div>
  </label>
    <ul class="menu">
        <li><a href="#">타임테이블</a></li>
        <li><a href="#">축제 지도 확인하기</a></li>
        <li><a href="#">플리마켓 / 제휴부스 / 총학부스</a></li>
        <li><a href="#">굿즈 구매 예약</a></li>
        <li><a href="#">공지사항</a></li>
        <li><a href="#">방명록</a></li>
        <li><a href="#">만든이들</a></li>
        <a href="#"><div class="box">관리자 모드</div></a>
    </ul>
  </header>
  <div class="container" id="blur">

  
  <form
    method="post"
    action="{% url 'order:reserve' %}"
    onsubmit="showReservation();"
  >
    {% csrf_token %}


    <!-- 굿즈 예약 설명 -->
    <div class="booking">
      <div class="top">
        <img src="{% static 'img/staricon.svg' %}" alt="반짝이" class="sparkle" />
        <span class="booking_text">굿즈 예약</span>
      </div>
    </div>
    <div class="insert">
      <div class="text">성함</div>
      <input
        type="text"
        placeholder="성함을 입력해주세요."
        class="text_input"
        name="user_name"
        required
      />
    </div>
    <div class="insert">
      <div class="text">연락처</div>
      <input
        type="text"
        placeholder="하이픈(-) 없이 작성해주세요."
        class="text_input"
        name="phone_number"
        required
      />
    </div>
    <div class="insert">
      <div class="text">이메일</div>
      <input type="text" placeholder="ex) mutsa@gmail.com" class="text_input" name="user_mail" required/>
    </div>

    <!-- 원하는 구매 일자 -->
    <div class="insert">
      <div class="text">원하는 구매 일자</div>
      <div class="select_date" style="display: flex; align-items: center;">
        {% for choice_value, choice_label in form.purchase_date.field.choices %}
        <label style="display: inline-block;">
          <input
              type="radio"
              name="{{ form.purchase_date.name }}"
              value="{{ choice_value }}"
              style="opacity: 0; display:flex; z-index: -1"
              id="radio_{{ forloop.counter }}"
              {% if forloop.first %}required{% endif %} />

        <img
          src="{% static 'img/checkboxNull.svg' %}"
          alt="체크 안 됨"
          id="check_icon{{ forloop.counter }}"
          class="check_icon"
          onclick="toggleImage('check_icon{{ forloop.counter }}', 'radio_{{ forloop.counter }}')"        />
        <!-- <span class="date">10월 4일</span>
        <img
          src="../img/checkboxNull.svg"
          alt="체크 안 됨"
          id="check_icon2"
          class="check_icon"
          onclick="toggleImage('check_icon2', 'check_icon1')"
        /> -->
        <!-- <span class="date">10월 5일</span> -->
        <span class="date">{{ choice_label }}</span>
      </label>
      {% endfor %}
      </div>
    </div>
    <!-- 구매 시간 -->
    <div class="insert">
      <div class="text">구매 시간</div>
      <select class="num_select" id="time_select" name="purchase_time" required>
        <option value="" disabled selected>시간 선택</option>
        {% for time_value, time_label in form.purchase_time.field.choices %}
        <option value="{{ time_value }}">{{ time_label }}</option>
        {% endfor %}
      </select>
    </div>
    <hr class="back"/>

      <!--선택한 상품 및 총액 확인 부분-->
      <!-- <h3>선택한 상품</h3> -->
      {% for good_name, good_info in request.session.selected_goods.items %}
      <!--세션을 통해서 선택한 굿즈 정보를 가져옴-->

      <!-- 예약 목록 -->
      <div class="list">
        <div class="select_item">
          <span class="item">{{ good_name }} - {{ good_info.quantity }}개</span>
          <span class="price"
            >{{ good_info.price|multiply:good_info.quantity }}₩</span
          >
        </div>
      </div>
      {% endfor %}

      <h3>총액: {{ total_price }} 원</h3>

    <!-- 예약 버튼 -->
    <div class="btn">
      <button type="submit" class="booking_btn" id="modalOpenButton">예약하기</button>
    </div>


    <!-- 모달 창 -->
    <div id="modalContainer" class="hidden">
      <div id="modalContent">
        <div class="done">
          <p class="booking_done">예약 완료!</p>

          <img src="{% static 'img/close.svg' %}" class="close" alt="닫기버튼" id="closeBtn" />
        </div>
        <div class="explain">
          <p class="content">송지연 님의 굿즈 구매 예약이 완료되었습니다!</p>
          <p class="content">
          해당 시간에 총학 부스에 와서 결제 후 수령해주세요.
          </p>
        </div>
        {% for good_name, good_info in request.session.selected_goods.items %}

        <div class="select_item">
          <ul>
            <div class="text2">
              <li class="popup_item">{{ good_name }} - {{ good_info.quantity }}개</span>
              <span class="popup_detail">{{ good_info.price|multiply:good_info.quantity }}₩</span>
            </div>
            <!-- <div class="text2">
              <li class="popup_item">PRISM 시리얼컵 - 1개</span>
              <span class="popup_detail">{{ good_info.price|multiply:good_info.quantity }}₩</span>
            </div> -->
          </ul>
        </div>
        {% endfor %}

        <hr />
        <div class="select_item">
          <span class="popup_item">예약 시간</span>
          <span class="popup_detail">11:00 ~ 12:00</span>
        </div>
        <hr />
        <div class="select_item">
          <span class="total_price">총 결제 금액</span>
          <span class="total_price2">{{ total_price }}₩</span>
        </div>

        <!-- btns를 modalContent 내에 위치시킵니다. -->
        <div class="btns">
          <button id="HomeButton" class="home">홈으로</button>
          <button id="goodsMoreButton" class="more">굿즈 더 보기</button>
        </div>
      </div>
    </div>
  </div>



    <!-- js -->
    <script>
      function toggle(){
        var blur=document.getElementById('blur');
        blur.classList.toggle('active')
      }

      //   날짜 선택
      let isChecked1 = false; // 10월 4일 이미지 상태
      let isChecked2 = false; // 10월 5일 이미지 상태

      function toggleImage(iconId, radioId) {
        const icon = document.getElementById(iconId);
        const radio = document.getElementById(radioId);

        if (!radio.checked) {
          // 모든 아이콘을 초기 상태로 설정합니다.
          document.querySelectorAll(".check_icon").forEach((iconElem) => {
            iconElem.setAttribute("src", "{% static 'img/checkboxNull.svg' %}");
          });
          // 선택한 아이콘만 체크 상태로 변경합니다.
          icon.setAttribute("src", "{% static 'img/checkbox.svg' %}");
          radio.checked = true;
        }
      }


      
      // 모달 창
      const modalOpenButton = document.getElementById("modalOpenButton");
      const HomeButton = document.getElementById("HomeButton");
      const goodsMoreButton = document.getElementById("goodsMoreButton");
      const closeButton = document.getElementById("closeBtn");
      const modal = document.getElementById("modalContainer");
      const header = document.querySelector(".header"); // header 요소 선택
      const overlay = document.createElement("div"); // 어두운 배경을 생성

      modalOpenButton.addEventListener("click", () => {
        modal.classList.remove("hidden");
        overlay.style.display = "block"; // 어두운 배경 표시
        document.body.style.overflow = "hidden"; // 스크롤 비활성화
        header.style.filter = "brightness(50%)"; // 헤더 어둡게 만들기

      });

      HomeButton.addEventListener("click", () => {
        modal.classList.add("hidden");
        document.body.style.overflow = "auto"; // 스크롤 활성화
        header.style.filter = "brightness(100%)"; // 헤더 복원
      });
      goodsMoreButton.addEventListener("click", () => {
        modal.classList.add("hidden");
        document.body.style.overflow = "auto"; // 스크롤 활성화
        header.style.filter = "brightness(100%)"; // 헤더 복원

      });
      closeButton.addEventListener("click", () => {
        modal.classList.add("hidden");
        document.body.style.overflow = "auto"; // 스크롤 활성화
        header.style.filter = "brightness(100%)"; // 헤더 복원

      });



    </script>
  </body>
</html>
