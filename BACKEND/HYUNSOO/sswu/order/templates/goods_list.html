{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="{% static 'css/goods_list.css' %}" />

    <title>booking</title>
  </head>
  <body>
    <!-- 상단바 -->
    <div class="top_bar">
      <a href="https://">
        <img
          src="{% static 'img/backicon.svg' %}"
          alt="백버튼"
          class="back_btn"
      /></a>
      <a href="https://">
        <img src="{% static 'img/prismPink.svg' %}" alt="로고" class="logo_img"
      /></a>
      <a href="https://">
        <img
          src="{% static 'img/hamburger.svg' %}"
          alt="햄버거 버튼"
          class="ham_btn"
      /></a>
    </div>
    <!-- 굿즈 예약 설명 -->
    <div class="booking">
      <div class="top">
        <img
          src="{% static 'img/staricon.svg' %}"
          alt="반짝이"
          class="sparkle"
        />
        <span class="booking_text">굿즈 예약</span>
      </div>
      <div class="choose">
        <p class="choose_ex">구매하고 싶은 굿즈들을 선택해주세요!</p>
      </div>
    </div>
    <form method="post" action="{% url 'order:goods_list' %}">
      {% csrf_token %} {% for good in goods %}
      <!--반복문을 돌면서 admin에서 미리 저장해둔 굿즈 목록을 반환함.-->

      <!-- 굿즈 선택 1 -->
      <div class="goods_choose" onclick="toggleGoods(this)">
        <img src="{% static 'img/checkicon.svg' %}" alt="체크" class="check" />
        <img
          src="{{ good.image.url }}"
          alt="{{ good.name }}"
          class="goods_img"
        />
        <div class="text">
          <div class="name">
            <span class="goods_name">{{ good.name }}</span>
            <span class="detail">상세보기</span>
          </div>
          <span class="goods_price">{{ good.price }}₩</span>
          <select class="num_select" id="num" name="quantity_{{good.id}}">
            <option value="" disabled selected>개수</option>
            {% for i in "123456789"|make_list %}
            <!--수량을 선택-->
            <option value="{{ i }}">{{ i }}개</option>
            {% endfor %}
          </select>
        </div>
      </div>
      {% endfor %}

      <!-- 예약버튼 -->
      <div class="btn">
        <input
          type="submit"
          class="booking_btn"
          value="선택한 굿즈들 예약하기"
          id="bookingBtn"
        />
      </div>
    </form>
    <!-- js -->
    <script>
      // select 요소의 변경 이벤트를 감지하는 함수를 추가합니다.
      document.addEventListener("DOMContentLoaded", function () {
        const selectElements = document.querySelectorAll(".num_select");

        selectElements.forEach(function (selectElement) {
          selectElement.addEventListener("change", function () {
            const checkImage =
              this.closest(".goods_choose").querySelector(".check");

            if (this.value !== "") {
              checkImage.style.display = "block";
              goodsChoose.style.border = "2px solid blue"; // 선택한 옵션이 있을 때 border 추가
            } else {
              checkImage.style.display = "none";
              goodsChoose.style.border = "none"; // 선택한 옵션이 없을 때 border 제거
            }
          });
        });
      });

      // 문서가 로드될 때 실행할 함수를 추가합니다.
      document.addEventListener("DOMContentLoaded", function () {
        const selectElements = document.querySelectorAll(".num_select");

        selectElements.forEach(function (selectElement) {
          selectElement.addEventListener("change", function () {
            // 해당 select 요소에 대한 goods_choose 요소를 찾습니다.
            const goodsChoose = this.closest(".goods_choose");

            // 선택한 옵션이 비어 있지 않은 경우에만 테두리를 추가합니다.
            if (this.value !== "") {
              goodsChoose.style.border = "1px solid #f06786";
            } else {
              goodsChoose.style.border = "none"; // 선택한 옵션이 없을 때 테두리를 제거합니다.
            }
          });
        });
      });

      // 문서가 로드될 때 실행할 함수를 추가합니다.
      document.addEventListener("DOMContentLoaded", function () {
        const selectElements = document.querySelectorAll(".num_select");
        const bookingBtn = document.querySelector(".booking_btn");

        selectElements.forEach(function (selectElement) {
          selectElement.addEventListener("change", function () {
            // 모든 select 요소를 확인하여 하나 이상의 옵션이 선택되었는지 확인합니다.
            let atLeastOneOptionSelected = false;
            selectElements.forEach(function (element) {
              if (element.value !== "") {
                atLeastOneOptionSelected = true;
              }
            });

            // 하나 이상의 옵션이 선택되었는지에 따라 버튼의 CSS 색상을 변경합니다.
            if (atLeastOneOptionSelected) {
              bookingBtn.style.backgroundColor = "#F06786"; // 버튼의 색상을 변경합니다.
            } else {
              bookingBtn.style.backgroundColor = ""; // 선택한 옵션이 없을 때 기본 색상으로 변경합니다.
            }
          });
        });
      });

      // 예약 버튼과 select 요소들을 가져옵니다.
      const bookingBtn = document.getElementById("bookingBtn");
      const selectElements = document.querySelectorAll(".num_select");

      // select 요소가 변경될 때마다 실행되는 함수를 정의합니다.
      function handleSelectChange() {
        let atLeastOneOptionSelected = false;

        // 모든 select 요소를 확인하여 옵션이 하나 이상 선택되었는지 확인합니다.
        selectElements.forEach(function (selectElement) {
          if (selectElement.value !== "") {
            atLeastOneOptionSelected = true;
          }
        });

        // 하나 이상의 옵션이 선택되었는지에 따라 버튼의 CSS 색상을 변경합니다.
        if (atLeastOneOptionSelected) {
          bookingBtn.style.backgroundColor = "#F06786"; // 버튼의 색상을 변경합니다.
          // 예약 버튼을 클릭했을 때, 원하는 페이지로 이동하도록 설정합니다.
          bookingBtn.addEventListener("click", function () {
            window.location.href = "https://www.naver.com"; // 여기에 이동할 페이지의 URL을 넣으세요.
          });
        } else {
          bookingBtn.style.backgroundColor = ""; // 선택한 옵션이 없을 때 기본 색상으로 변경합니다.
          bookingBtn.removeEventListener("click", function () {
            window.location.href = "https://www.naver.com"; // 이전에 설정된 이벤트 제거
          });
        }
      }

      // 모든 select 요소에 대한 변경 이벤트 리스너를 추가합니다.
      selectElements.forEach(function (selectElement) {
        selectElement.addEventListener("change", handleSelectChange);
      });
    </script>
  </body>
</html>
